{% do doc.styles.addCssFile('/css/components/organisms/search.css') %}

{% do doc.amp_dependencies.add('amp-autocomplete', '0.1') %}
{% do doc.amp_dependencies.add('amp-form', '0.1') %}
{% do doc.amp_dependencies.add('amp-bind', '0.1') %}
{% do doc.amp_dependencies.add('amp-list', '0.1') %}
{% do doc.amp_dependencies.add('amp-mustache', '0.2', 'template') %}

<div id="searchLayer" class="ap-o-search">
  <div class="ap-m-search-trigger ap-m-search-trigger-close" on="tap:searchLayer.toggleClass(class='active'),searchTriggerOpen.focus" role="button" tabindex="0">
    {% do doc.icons.useIcon('/icons/close.svg') %}
    <div class="ap-a-ico ap-m-search-trigger-icon">
      <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#close"></use></svg>
    </div>
  </div>

{% raw %}
<template id="search_results_template" type="amp-mustache">
  <div class="ap-o-search-result-list">
    {{#result.components}}
    <div class="ap-o-search-result-item ap-o-search-result-item-component">
      <a href="{{url}}">
        <strong class="title">{{title}}</strong>
        <p class="copy">{{description}}</p>
      </a>
      {{#exampleUrl}}
      <a class="ap-m-lnk" href="{{exampleUrl}}">
        <span class="ap-m-lnk-text">Show example</span>
      </a>
      {{/exampleUrl}}
      {{#playgroundUrl}}
      <a class="ap-m-lnk"href="{{playgroundUrl}}">
        <span class="ap-m-lnk-text">Show example in playground</span>
      </a>
      {{/playgroundUrl}}
    </div>
    {{/result.components}}

    <hr>

    {{#result.pages}}
    <div class="ap-o-search-result-item">
      <a href="{{url}}">
        <strong class="title">{{title}}</strong>
        <p class="copy">{{description}}</p>
      </a>
    </div>
    {{/result.pages}}
  </div>
</template>
{% endraw %}

  <div class="ap-o-search-field">
    <form action-xhr="/search/do" class="ap-o-search-form" id="searchForm" method="GET"
          on="input-throttled:searchLayer.toggleClass(class='active', force=true);
              submit-success: AMP.setState({'showResults': true, 'search': event.response, 'totalResults': event.response.result.totalResults})"
          target="_top">
      <amp-autocomplete class="ap-o-search-autocomplete"
                        filter="substring"
                        min-characters="0"
                        on="select:searchForm.submit"
                        submit-on-enter="false"
                        src="/search/autosuggest"
      >
        {% do doc.icons.useIcon('/icons/search.svg') %}
        <div class="ap-a-ico ap-o-search-input-icon">
          <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#search"></use></svg>
        </div>
        <input id="searchInput" class="ap-o-search-input" name="q" placeholder="What are you looking for?" tabindex="1" required>
      </amp-autocomplete>

      <input name="locale" type="hidden" value="{{ doc.locale }}">

      <p [text]="totalResults + ' results found'" class="ap-o-search-info"></p>

      <div submit-success template="search_results_template"></div>
      <div submit-error>
        An internal server error occurred while trying to load the search results.<br>
        We apologize for the inconvenience caused.<br>
        Please try again later.
      </div>
    </form>

    <div [hidden]="totalResults <= 10" hidden>
      <amp-list [height]="(100) * search.result.components.length + (80) * search.result.pages.length"
                [src]="search.nextUrl"
                binding="no"
                class="paged-amp-list"
                height="10"
                items="."
                layout="fixed-height"
                load-more="auto"
                load-more-bookmark="nextUrl"
                template="search_results_template"
                reset-on-refresh
                single-item
      >
        <div overflow>
          <button>Show more</button>
        </div>

        <amp-list-load-more load-more-failed>
          An internal server error occurred while trying to load more search results.<br>
          We apologize for the inconvenience caused.<br>
          Please try again later.
        </amp-list-load-more>

        <amp-list-load-more load-more-end>
          You have reached the end of the results.
        </amp-list-load-more>
      </amp-list>

      <div [hidden]="totalResults <= 100" hidden>
        Although there are <span [text]="totalResults">&gt; 100</span> hits in total we can not show more than 100.
      </div>
    </div>
  </div>

  <div [hidden]="showResults" class="ap-o-search-teaser-list">
    <div class="ap-o-search-teaser-item">
      <h1>Important AMP components</h1>
      <p>Our vision is our north star we use to orient ourselves, and our mission describes the way we move into the direction of it.</p>
    </div>

    <div class="ap-o-search-teaser-item">
      <h1>Popular Articles</h1>
      <p>These design principles are meant to guide the ongoing design and development of AMP. They should help us make internally consistent decisions.</p>
    </div>
  </div>
</div>
