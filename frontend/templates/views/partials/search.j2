{% do doc.styles.addCssFile('/css/components/organisms/search.css') %}
{% do doc.styles.addCssFile('/css/components/molecules/copy.css') %}

{% do doc.amp_dependencies.add('amp-autocomplete', '0.1') %}
{% do doc.amp_dependencies.add('amp-form', '0.1') %}
{% do doc.amp_dependencies.add('amp-bind', '0.1') %}
{% do doc.amp_dependencies.add('amp-list', '0.1') %}
{% do doc.amp_dependencies.add('amp-mustache', '0.2', 'template') %}

<div class="ap-o-search">

{% raw %}
<template id="search_results_template" type="amp-mustache">
  <div class="component-item">
    {{#result.components}}
    <div class="item">
      <a href="{{url}}">
        <strong class="title">{{title}}</strong>
        <p class="copy">{{description}}</p>
      </a>
      {{#exampleUrl}}
      <a class="ap-m-lnk" href="{{exampleUrl}}">
        <span class="ap-m-lnk-text">Show example</span>
      </a>
      {{/exampleUrl}}
      {{#playgroundUrl}}
      <a class="ap-m-lnk"href="{{playgroundUrl}}">
        <span class="ap-m-lnk-text">Show example in playground</span>
      </a>
      {{/playgroundUrl}}
    </div>
    <hr>
    {{/result.components}}
  </div>

  <div class="items">
    {{#result.pages}}
    <div class="item">
      <a href="{{url}}">
        <strong class="title">{{title}}</strong>
        <p class="copy">{{description}}</p>
      </a>
    </div>
    {{/result.pages}}
  </div>
</template>
{% endraw %}

<section class="ap--container">

  <div class="ap-m-copy ap-m-copy-center-small ap-m-biggy-background">
    <h1>Search</h1>
    <form action-xhr="/search/do" class="search-form" id="searchForm" method="GET"
          on="submit-success: AMP.setState({'showResults': true, 'search': event.response, 'totalResults': event.response.result.totalResults})"
          target="_top">
      <amp-autocomplete filter="substring"
                        min-characters="0"
                        on="select:searchForm.submit"
                        submit-on-enter="false"
                        src="/search/autosuggest"
      >
        <input name="q" placeholder="What are you looking for?" required>
      </amp-autocomplete>
      <input name="locale" type="hidden" value="{{ doc.locale }}">
      <button type="submit">Search</button>

      <p [text]="totalResults + ' results found'" class="info"></p>

      <div submit-success template="search_results_template"></div>
      <div submit-error>
        An internal server error occurred while trying to load the search results.<br>
        We apologize for the inconvenience caused.<br>
        Please try again later.
      </div>

    </form>

    <div [hidden]="totalResults <= 10" hidden>

      <amp-list [height]="(100) * search.result.components.length + (80) * search.result.pages.length"
                [src]="search.nextUrl"
                binding="no"
                class="paged-amp-list"
                height="10"
                items="."
                layout="fixed-height"
                load-more="auto"
                load-more-bookmark="nextUrl"
                template="search_results_template"
                reset-on-refresh
                single-item>

        <div overflow>
          <button>Show more</button>
        </div>

        <amp-list-load-more load-more-failed>
          An internal server error occurred while trying to load more search results.<br>
          We apologize for the inconvenience caused.<br>
          Please try again later.
        </amp-list-load-more>

        <amp-list-load-more load-more-end>
          You have reached the end of the results.
        </amp-list-load-more>

      </amp-list>

      <div [hidden]="totalResults <= 100" hidden>
        Although there are <span [text]="totalResults">&gt; 100</span> hits in total we can not show more than 100.
      </div>

    </div>
  </div>

  <div class="ap--divider"></div>

</section>


<section [hidden]="showResults" class="ap--container">

  <div class="ap-m-copy ap-m-copy-center-small ap-m-biggy-background">
    <h1>Important AMP components</h1>
    <p>Our vision is our north star we use to orient ourselves, and our mission describes the way we move into the direction of it.</p>
  </div>

  <div class="ap--divider"></div>

</section>

<section [hidden]="showResults" class="ap--container">

  <div class="ap-m-copy no-margin ap-m-copy-center-small ap-m-biggy-background">
    <h1>Popular Articles</h1>
    <p>These design principles are meant to guide the ongoing design and development of AMP. They should help us make internally consistent decisions.</p>
  </div>

  <div class="ap--divider"></div>


</section>
</div>
