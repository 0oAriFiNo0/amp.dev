{% do doc.styles.addCssFile('/css/components/organisms/search.css') %}

{% do doc.icons.useIcon('/icons/search.svg') %}
{% do doc.icons.useIcon('icons/internal.svg') %}
{% do doc.icons.useIcon('/icons/close.svg') %}

{% do doc.amp_dependencies.add('amp-autocomplete', '0.1') %}
{% do doc.amp_dependencies.add('amp-form', '0.1') %}
{% do doc.amp_dependencies.add('amp-bind', '0.1') %}
{% do doc.amp_dependencies.add('amp-list', '0.1') %}
{% do doc.amp_dependencies.add('amp-mustache', '0.2', 'template') %}

<div id="searchLayer" class="ap-o-search" tabindex="-1">
  <div class="ap-o-search-container">
    <div class="ap-m-search-trigger ap-m-search-trigger-close" on="tap:searchLayer.toggleClass(class='active'),searchTriggerOpen.focus" role="button" tabindex="0">
      <div class="ap-a-ico ap-m-search-trigger-icon">
        <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#close"></use></svg>
      </div>
    </div>

  {% raw %}
  <template id="search_results_template" type="amp-mustache">
    <div class="ap-o-search-result-list">
      <h3 class="ap-o-search-result-category">Components</h3>
      {{#result.components}}
      <div class="ap-o-search-result-item">
        <a class="ap-o-search-result-link" href="{{url}}">
          <h4 class="ap-o-search-result-title">{{title}}</h4>
          <p class="ap-o-search-result-description">{{description}}</p>
        </a>
        <div class="ap-o-search-result-linklist">
          {{-#exampleUrl-}}
          <a class="ap-o-search-result-linklist-item ap-m-lnk" href="{{exampleUrl}}">
            <div class="ap-a-ico ap-m-lnk-icon">
              <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#internal"></use></svg>
            </div>
            <span class="ap-m-lnk-text">Open example</span>
          </a>
          {{-/exampleUrl-}}
          {{-#playgroundUrl-}}
          <a class="ap-o-search-result-linklist-item ap-m-lnk"href="{{playgroundUrl}}">
            <div class="ap-a-ico ap-m-lnk-icon">
              <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#internal"></use></svg>
            </div>
            <span class="ap-m-lnk-text">Open in playground</span>
          </a>
          {{-/playgroundUrl-}}
        </div>
      </div>
      {{/result.components}}

      <h3 class="ap-o-search-result-category">Examples</h3>
      {{#result.pages}}
      <div class="ap-o-search-result-item">
        <a class="ap-o-search-result-link" href="{{url}}">
          <h4 class="ap-o-search-result-title">{{title}}</h4>
          <p class="ap-o-search-result-description">{{description}}</p>
        </a>
      </div>
      {{/result.pages}}
    </div>
  </template>
  {% endraw %}

    <div class="ap-o-search-field">
      <form action-xhr="/documentation/examples/api/echo" class="ap-o-search-form" id="searchForm" method="POST" target="_top">
        <amp-autocomplete class="ap-o-search-autocomplete"
                          filter="substring"
                          min-characters="0"
                          on="select:AMP.setState({ query: event.value }),searchLayer.focus"
                          submit-on-enter="false"
                          src="/search/autosuggest"
        >
          <div class="ap-a-ico ap-o-search-input-icon">
            <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#search"></use></svg>
          </div>
          <input id="searchInput"
                 class="ap-o-search-input"
                 name="q"
                 placeholder="What are you looking for?"
                 on="input-debounced:AMP.setState({ query: event.value })"
                 required
          >
        </amp-autocomplete>

        <input name="locale" type="hidden" value="{{ doc.locale }}">

        <p [text]="search.result.totalResults + ' results found'" class="ap-o-search-info"></p>

        <div submit-error>
          An internal server error occurred while trying to load the search results.<br>
          We apologize for the inconvenience caused.<br>
          Please try again later.
        </div>
      </form>

      <div class="ap-o-search-result">

        <amp-state id="search" [src]="'/search/do?q=' + encodeURIComponent(query) + '&locale={{ doc.locale }}'"></amp-state>
        <amp-list [src]="'/search/do?q=' + encodeURIComponent(query) + '&locale={{ doc.locale }}'"
                  binding="no"
                  class="paged-amp-list"
                  items="."
                  height="10"
                  layout="fixed-height"
                  [is-layout-container]="query.length"
                  load-more="auto"
                  load-more-bookmark="nextUrl"
                  template="search_results_template"
                  reset-on-refresh
                  single-item
        >
          <amp-list-load-more load-more-button>
            <div class="ap-o-search-result-load-button" overflow>
              <button class="ap-a-btn">Load more</button>
            </div>
          </amp-list-load-more>

          <amp-list-load-more class="ap-o-search-result-load-hint" load-more-failed>
            An internal server error occurred while trying to load more search results.<br>
            We apologize for the inconvenience caused.<br>
            Please try again later.
          </amp-list-load-more>

          <amp-list-load-more class="ap-o-search-result-load-hint" load-more-end>
            You have reached the end of the results.
          </amp-list-load-more>
        </amp-list>

        <div class="ap-o-search-result-load-hint" [hidden]="search.result.totalResults <= 100" hidden>
          Although there are <span [text]="search.result.totalResults">&gt; 100</span> hits in total we can not show more than 100.
        </div>
      </div>
    </div>

    <div [hidden]="query.length" class="ap-o-search-result-list">
      <h3 class="ap-o-search-result-category">Popular Articles</h3>

      <div class="ap-o-search-result-item">
        <a class="ap-o-search-result-link" href="#">
          <h4 class="ap-o-search-result-title">Getting Started</h4>
          <p class="ap-o-search-result-description">AMP is a web component framework to create lightning fast, user first, immersive websites, full-screen stories, secure and engaging ads and dynamic email.</p>
        </a>
      </div>

      <div class="ap-o-search-result-item">
        <a class="ap-o-search-result-link" href="#">
          <h4 class="ap-o-search-result-title">AMP websites</h4>
          <p class="ap-o-search-result-description">AMP is a simple and robust format to ensure your website is fast, user-first, and makes money. AMP provides long-term success for your web strategy with distribution across popular platforms …</p>
        </a>
      </div>

      <div class="ap-o-search-result-item">
        <a class="ap-o-search-result-link" href="#">
          <h4 class="ap-o-search-result-title">Basics of scrollbound effects</h4>
          <p class="ap-o-search-result-description">amp-position-observer combined with amp-animation is a powerful building block that can handle various uses-cases such as scrollbound animations, parallax effects and transitions as elements …</p>
        </a>
      </div>
    </div>
  </div>
</div>
